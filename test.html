<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>SheopurMBK - Bulk Save</title>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 20px; }
h2, h3 { color: #333; }
table { border-collapse: collapse; width: 100%; background: #fff; }
table, th, td { border: 1px solid #ccc; }
th, td { padding: 6px; text-align: center; }
th { background: #4CAF50; color: white; }
tr:nth-child(even) { background: #f9f9f9; }
input, select, button { padding: 6px; margin: 4px 0; border: 1px solid #ccc; border-radius: 4px; width: 100%; }
button { cursor: pointer; }
.action-btn { padding: 4px 8px; margin: 0 2px; border-radius: 3px; font-size: 12px; }
.edit-btn { background: orange; color: #fff; border: none; }
.delete-btn { background: red; color: #fff; border: none; }
.save-btn { background: green; color: #fff; border: none; padding: 6px 12px; }
.form-box { background: #fff; padding: 15px; border: 1px solid #ccc; margin-bottom: 10px; border-radius: 5px; max-width: 800px; }
.form-row { display: flex; gap: 10px; margin-bottom: 8px; }
.form-group { flex: 1; }
tfoot td { font-weight: bold; background: #eee; }
</style>
</head>
<body>

<h2>SheopurMBK - Local Entry Table (Bulk Save)</h2>

<div class="form-box">
  <h3>नया डेटा दर्ज करें</h3>
  <form id="entryForm">
    <div class="form-row">
      <div class="form-group">
        <label>दिनांक</label>
        <input type="date" id="दिनांक" required>
      </div>
      <div class="form-group">
        <label>जिन्स</label>
        <select id="जिन्स"></select>
      </div>
      <div class="form-group">
        <label>पर्चे संख्या</label>
        <input type="number" id="पर्चे संख्या">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>मात्रा (बोरी)</label>
        <input type="number" id="मात्रा (बोरी)" step="0.01">
      </div>
      <div class="form-group">
        <label>मात्रा (कु.)</label>
        <input type="number" id="मात्रा (कु.)" step="0.01">
      </div>
      <div class="form-group">
        <label>न्यूनत्तम</label>
        <input type="number" id="न्यूनत्तम" step="0.01">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>मॉडल</label>
        <input type="number" id="मॉडल" step="0.01">
      </div>
      <div class="form-group">
        <label>अधिकत्तम</label>
        <input type="number" id="अधिकत्तम" step="0.01">
      </div>
      <div class="form-group" style="display:flex;align-items:flex-end;">
        <button type="button" onclick="addOrUpdate()" class="save-btn">टेबल में जोड़ें</button>
      </div>
    </div>
  </form>
</div>

<h3>Staging Table</h3>
<table id="stagingTable">
  <thead>
    <tr>
      <th>दिनांक</th><th>जिन्स</th><th>पर्चे संख्या</th>
      <th>मात्रा (बोरी)</th><th>मात्रा (कु.)</th>
      <th>न्यूनत्तम</th><th>मॉडल</th><th>अधिकत्तम</th>
      <th>एक्शन</th>
    </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr>
      <td colspan="2">कुल</td>
      <td id="totalParche">0</td>
      <td id="totalBori">0</td>
      <td id="totalKu">0</td>
      <td colspan="4"></td>
    </tr>
  </tfoot>
</table>

<br>
<button onclick="submitToSheet()" class="save-btn">Submit to Google Sheet</button>

<script>
const api = "https://script.google.com/macros/s/AKfycbwZjNymnBi7-yqhzMtHeHfsTiKUDZcngjaWL1GL7MsKjRwiyJaH9nU7D1hMiOKxFuhh/exec"; // यहां अपना Web App URL डालें
let stagingData = [];
let editIndex = -1;

async function loadJinsList() {
  try {
    const res = await fetch(`${api}?action=getJinsList`);
    const jinsArray = await res.json();
    const jinsSelect = document.getElementById("जिन्स");
    jinsSelect.innerHTML = "";
    jinsArray.forEach(jins => {
      const opt = document.createElement("option");
      opt.value = jins;
      opt.textContent = jins;
      jinsSelect.appendChild(opt);
    });
  } catch (err) {
    console.error("JINS लिस्ट लोड एरर:", err);
  }
}

function addOrUpdate() {
  const record = {};
  ["दिनांक","जिन्स","पर्चे संख्या","मात्रा (बोरी)","मात्रा (कु.)","न्यूनत्तम","मॉडल","अधिकत्तम"]
    .forEach(id => record[id] = document.getElementById(id).value);

  if (editIndex === -1) {
    stagingData.push(record);
