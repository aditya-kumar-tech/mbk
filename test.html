<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>SheopurMBK Data</title>
<style>
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
table, th, td { border: 1px solid black; padding: 5px; }
input, select, button { margin: 3px; padding: 5px; }
</style>
</head>
<body>

<h2>SheopurMBK डेटा</h2>

<label>दिनांक से खोजें:</label>
<input type="date" id="searchDate">
<button onclick="loadFiltered()">खोजें</button>
<button onclick="loadAll()">सभी दिखाएं</button>

<h3>नया / अपडेट डेटा</h3>
<form id="dataForm">
  <input type="hidden" id="id">
  दिनांक: <input type="date" id="दिनांक" required>
  जिन्स: <input type="text" id="जिन्स"><br>
  पर्चे संख्या: <input type="text" id="पर्चे संख्या">
  मात्रा (बोरी): <input type="number" id="मात्रा (बोरी)">
  मात्रा (कु.): <input type="number" id="मात्रा (कु.)"><br>
  न्यूनत्तम: <input type="number" id="न्यूनत्तम">
  मॉडल: <input type="number" id="मॉडल">
  अधिकत्तम: <input type="number" id="अधिकत्तम"><br>
  <button type="submit">Save</button>
</form>

<h3>डेटा सूची</h3>
<table id="dataTable">
  <thead>
    <tr>
      <th>ID</th><th>दिनांक</th><th>जिन्स</th><th>पर्चे संख्या</th>
      <th>मात्रा (बोरी)</th><th>मात्रा (कु.)</th>
      <th>न्यूनत्तम</th><th>मॉडल</th><th>अधिकत्तम</th><th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const api = "YOUR_WEB_APP_URL"; // यहां अपना deployed WebApp URL डालें

async function loadAll() {
  const res = await fetch(api);
  const data = await res.json();
  renderTable(data);
}

async function loadFiltered() {
  const date = document.getElementById("searchDate").value;
  if (!date) return alert("कृपया दिनांक चुनें");
  const res = await fetch(`${api}?action=getDataByDate&date=${encodeURIComponent(date)}`);
  const data = await res.json();
  renderTable(data);
}

function renderTable(data) {
  const tbody = document.querySelector("#dataTable tbody");
  tbody.innerHTML = "";
  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.id}</td>
      <td>${row["दिनांक"]}</td>
      <td>${row["जिन्स"]}</td>
      <td>${row["पर्चे संख्या"]}</td>
      <td>${row["मात्रा (बोरी)"]}</td>
      <td>${row["मात्रा (कु.)"]}</td>
      <td>${row["न्यूनत्तम"]}</td>
      <td>${row["मॉडल"]}</td>
      <td>${row["अधिकत्तम"]}</td>
      <td>
        <button onclick='editRow(${JSON.stringify(row)})'>Edit</button>
        <button onclick='deleteRow("${row.id}")'>Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function editRow(row) {
  for (let key in row) {
    if (document.getElementById(key)) {
      document.getElementById(key).value = row[key];
    }
  }
}

async function deleteRow(id) {
  if (!confirm("क्या आप वाकई delete करना चाहते हैं?")) return;
  const res = await fetch(`${api}?action=delete&id=${id}`);
  const result = await res.json();
  if (result.status === "success") {
    loadAll();
  } else {
    alert("Error deleting");
  }
}

document.getElementById("dataForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const record = {};
  ["id","दिनांक","जिन्स","पर्चे संख्या","मात्रा (बोरी)","मात्रा (कु.)","न्यूनत्तम","मॉडल","अधिकत्तम"].forEach(id => {
    record[id] = document.getElementById(id).value;
  });

  let action = record.id ? "update" : "add";
  const res = await fetch(`${api}?action=${action}&data=${encodeURIComponent(JSON.stringify(record))}`);
  const result = await res.json();
  if (result.status === "success") {
    document.getElementById("dataForm").reset();
    loadAll();
  } else {
    alert("Error saving data");
  }
});

loadAll();
</script>
</body>
</html>
